---
title: "网络流"
tags: dm
---

## 网络流

网络流用到的符号：

- $V$是整个图中所有顶点的集合
- $E$是整个图中所有边的集合
- $G=(V, E)$表示整个图
- $s$表示网络的**源点**
- $t$表示网络的**汇点**
- 每条边$(u, v)$有一个容量$c(u, v)$ ($c(u, v)\ge 0$)。如果$c(u, v)=0$，表示边不存在；如果$c(u, v) > 0$，表示$u, v$之间有边。
- 对于每条边$(u, v)$，有一个实际流量$f(u, v)$

网络流的三个性质：

1. **容量限制**：$f(u, v)\le c(u, v)$
2. **反对称性**：$f(u, v) = -f(v, u)$
3. **流量平衡**：对于不是源点也不是汇点的任意结点，流入该结点的流量等于流出该结点的流量。即对于任何结点$v$，有

$$
\sum_{u\in V}f(v, u) = 0
$$

只要满足这三个性质，就是一个合法的**网络流**（**可行流**）。每个图至少有一个可行流——零流。

定义**网络流量**为

$$
F=\sum_{v\in V}f(s, v)
$$

**最大流问题**即求在满足网络流三条性质的前提下，$F$的最大值。

### 残量网络

弧的分类。对一个给定的可行流$F$：

- **零流弧**：$f(u, v)=0$
- **非零流弧**：$f(u, v)>0$
- **饱和弧**：$f(u, v)=c(u, v)$
- **非饱和弧**：$f(u, v)<c(u, v)$

若$P$是连接源点到汇点的一条路，则称路的方向是从$V_s$到$V_t$，路上的弧被分为两类：

- **前向弧**：与路方向一致的边
- **后向弧**：与路方向相反的边

根据原网络定义一个**残量网络**，其中$r(u, v)$为残量网络的容量：

$$
r(u, v)=c(u, v)-f(u, v)
$$

残量网络不仅可以描述一条边还可以增加多少流量，也可以描述还可以减少多少流量。

- 与原网络同向的边描述了“可增流量”
- 与原网络反向的边描述了“可减流量”
- 残留量为0的边在残量网络中忽略

![r network](/assets/dm_29.png)

**可改进路**是残量网络一条从$s$通往$t$的路径，任意一条弧$(u, v)$都有$r(u, v)>0$（每一条前向弧都是非饱和弧，每一条后向弧都是非零流弧。）

![gg](/assets/dm_30.png)

### 标号法

使用Ford-Fulkerson算法（**标号法**）找到最大网络。

标号：

- 网络中的顶点或是标号点（已检查/未检查）或是未标号点。
- 每个标号顶点$v_i$，其标号为$(v_x, L(v_x))$
  - $v_x$表示$v_i$的标号从哪个顶点得到
    - 若$V_x$前面为"+"号，则表示有一条有向边$(v_x, v_i)$，且该有向边流量不满，$v_x$到$v_i$流量可增加。
    - 若$v_x$前面为"-"号，则表示有一条有向边$(v_i, V_x)$，且该有向边流量不为零，$v_i$到$v_x$的流量可减少。
  - $L(v_x)$表示可增加或可减少的最大流量。

标号过程：

- 标号过程开始，先给起点$v_s$标上$(0, +\infty)$，这是$v_s$是标号而未检查点，其余都是未标号点。
- 取一个标号而未检查点$v_i$进行检查，考察与他相邻的每个未标号点$v_j$：
  - 若在弧$(v_i, v_j)$上$f(i, j)<c(i, j)$，则给$v_j$标号$(v_i, L(v_j))$，这里$L(v_j)=\min[L(v_i), c(i, j)-f(i, j)]$，这时$v_j$称为标号而未检查点。
  - 若在弧$(v_j, v_i)$上$f(i, j)>0$，则给$v_j$标号$(-v_i, L(v_j))$，这里$L(v_j)=\min[L(v_i), f(i, j)]$，这时$v_j$成为标号而未检查点。
- 在$v_i$的全部可标号相邻顶点均已标号后，$v_i$称为标号已检查点。不断重复第二步，检查新产生的标号但未检查顶点。一旦终点$v_t$被标上号，则表明得到一条从$v_s$到$v_t$的可改进路$P$，转入调整过程。

调整过程：

采用倒向追踪方法，从终点$v_t$开始，利用标号的前半部分$v_x$找出可改进路$P$，并以所有标号的后半部分$L(v_x)$的最小值$a$作为改进量，改进$P$上的流量。

$$
f(i, j)^\prime=\begin{cases}
f(i, j)+a & (v_i, v_j)\in P^+ (前向弧)\\
f(i, j)-a & (v_i, v_j) \in P^- (后向弧)\\
f(i, j) & (v_i, v_j)\not\in P
\end{cases}
$$

去掉所有标号，对新的可行流重新进入标号过程，直到标号过程无法继续。

![Ford-Fulkerson](/assets/dm_31.png)

### 增加最大流

一个网络的**割集** $(S, T)$有两个点集$S, T$组成。其中

- $S \cup T = V$
- $s \in S$
- $t \in T$

割集间的容量定义为：

$$
C(S, T)=\sum_{x\in S}\sum_{y\in T}c(x, y)
$$

即所有由$S$中的一点指向$T$中的一点的边上的容量之和。

**最大流最小割**定理指出任一网络$D$中从$v_s$到$v_t$的最大流的流量等于分离$v_s$和$v_t$的割集中容量最小的割集的容量。

定理1：$X, Y, Z$为不相交的顶点子集。

- $f(X, X) = 0$
- $f(X, Y) = f(Y, X)$
- $f(X\cup Y, Z) = f(X, Z) + f(Y, Z)$
- $f(X, Y\cup Z) = f(X, Y) + f(X, Z)$

定理2：任何不包含$s, t$的顶点集$X$与他相关联的边上的流量之和为0. 

$$
f(X, V)=\sum_{x\in X}\sum_{v\in V}f(x, v) = 0
$$

定理3：整个网络的流量等于任意割的流量。

构成最小割的边的求解步骤为：

1. 求最大流。
2. 求最大流的残量网络。
3. 在残量网络中，所有可以由源点出发到达的节点集合为$S$，其余节点$T$，则$S, T$为一个最小割。
4. 所有连接$S, T$的边为最小割的边。

### 二部图最大匹配

**二部图**：设无向图$G(V, E)$，它的顶点集合$V$包含两个没有公共元素的子集$X: \{x_1, x_2, \cdots, x_s\}$和$Y=\{y_1, y_2, \cdots, y_t\}$， 元素个数分别为$s$和$t$：并且$x_i$与$x_j$之间($1\le i, j\le s$)，$y_l$与$y_r$之间（$1\le l, r\le t$）之间没有边连接，则称$G$为二部图。

![bipartite graph](/assets/dm_32.png)

利用网络流求二部图最大匹配的过程：

1. 从二部图$G$构造一个容量网络$G^\prime$，步骤如下：

    1. 增加一个源点$s$和汇点$t$
    2. 从$s$向$X$的每一个顶点都画一条有向弧，从$Y$的每一个顶点都向$t$画一条有向弧
    3. 原来$G$中的边都改成有向弧，方向从$X$的顶点指向$Y$的顶点
    4. 令所有弧的容量都等于1（流量等于整数）

2. 求容量网络$G^\prime$的最大流$F$
3. 从$X$的顶点指向$Y$的顶点的弧集合中，弧流量为1的弧对应二部图最大匹配中的边，最大流$F$的流量对应二部图的最大匹配的边数。